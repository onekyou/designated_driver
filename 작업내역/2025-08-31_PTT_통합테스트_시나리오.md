# PTT AccessibilityService 통합 테스트 시나리오

## 📅 작성일시
2025-08-31

## 🎯 테스트 목표
AccessibilityService 기반 볼륨 PTT 시스템의 완전한 통합 테스트 및 검증

---

## 📋 테스트 시나리오

### 🧪 Scenario 1: 권한 및 서비스 설정 테스트

#### Test Case 1.1: 접근성 서비스 설정 가이드
- **목적**: 사용자가 쉽게 접근성 서비스를 설정할 수 있는지 검증
- **절차**:
  1. PTTAccessibilityGuideActivity 실행
  2. "설정으로 이동" 버튼 클릭
  3. 접근성 설정 화면 진입 확인
  4. Call Manager PTT 서비스 활성화
  5. 가이드 화면 자동 완료 처리 확인

**예상 결과**: 
- ✅ 설정 화면 정상 진입
- ✅ 서비스 활성화 시 자동 완료
- ✅ 2초 후 자동 종료

#### Test Case 1.2: 권한 최소화 검증
- **목적**: 불필요한 권한 요청 없이 PTT 기능 동작 확인
- **검증 항목**:
  - `typeWindowStateChanged`만 사용 (typeAllMask 사용 안 함)
  - `flagRequestFilterKeyEvents`만 설정
  - 불필요한 접근성 기능 비활성화 확인

**예상 결과**: 
- ✅ 최소 권한으로 정상 동작
- ✅ 보안 스캔 통과

### 🧪 Scenario 2: 볼륨키 PTT 기능 테스트

#### Test Case 2.1: 볼륨키 이벤트 캡처
- **목적**: 볼륨 Up/Down 키 이벤트 정상 캡처 확인
- **절차**:
  1. 접근성 서비스 활성화 확인
  2. 볼륨 Up 키 단일 클릭
  3. 볼륨 Down 키 단일 클릭
  4. 로그에서 이벤트 캡처 확인

**예상 결과**:
- ✅ 볼륨키 이벤트 100% 캡처
- ✅ 디바운싱 처리 정상 (100ms)
- ✅ 시스템 볼륨 조절 차단

#### Test Case 2.2: PTT 송수신 기능
- **목적**: 볼륨키로 실제 PTT 송수신 동작 확인
- **절차**:
  1. 볼륨키 누르기 (PTT 시작)
  2. PTTManagerService 연동 확인
  3. Agora SDK 송신 시작 확인
  4. 볼륨키 놓기 (PTT 중지)
  5. 송신 중지 확인

**예상 결과**:
- ✅ PTT 시작 지연시간 < 200ms
- ✅ 백그라운드에서 정상 동작
- ✅ 오디오 포커스 정상 관리

### 🧪 Scenario 3: 백그라운드 안정성 테스트

#### Test Case 3.1: 화면 꺼진 상태 PTT
- **목적**: 화면이 꺼진 상태에서도 PTT 정상 동작 확인
- **절차**:
  1. PTT 서비스 모두 활성화
  2. 화면 끄기 (전원 버튼)
  3. 볼륨키로 PTT 시도
  4. 백그라운드 동작 확인

**예상 결과**:
- ✅ 화면 꺼진 상태에서도 정상 동작
- ✅ WakeLock 정상 획득/해제
- ✅ 배터리 최적화 영향 없음

#### Test Case 3.2: 앱 전환 중 PTT
- **목적**: 다른 앱 사용 중에도 PTT 정상 동작 확인
- **절차**:
  1. Call Manager 백그라운드 전환
  2. 다른 앱 실행 (카메라, 브라우저 등)
  3. 볼륨키로 PTT 시도
  4. 앱 간섭 없이 동작 확인

**예상 결과**:
- ✅ 다른 앱 사용 중에도 정상 동작
- ✅ 오디오 포커스 경합 정상 처리
- ✅ 시스템 안정성 유지

### 🧪 Scenario 4: 서비스 모니터링 테스트

#### Test Case 4.1: 서비스 자동 복구
- **목적**: 접근성 서비스 비활성화 시 자동 감지 및 복구 확인
- **절차**:
  1. 접근성 서비스 수동 비활성화
  2. 30초 대기 (모니터링 주기)
  3. 재활성화 알림 확인
  4. Quick Settings 타일 상태 확인

**예상 결과**:
- ✅ 30초 이내 비활성화 감지
- ✅ 재활성화 알림 표시
- ✅ Quick Settings 타일 상태 업데이트

#### Test Case 4.2: WorkManager 백그라운드 모니터링
- **목적**: 앱 종료 후에도 백그라운드 모니터링 동작 확인
- **절차**:
  1. Call Manager 앱 완전 종료
  2. 15분 대기 (WorkManager 주기)
  3. 접근성 서비스 비활성화
  4. 백그라운드 알림 확인

**예상 결과**:
- ✅ 앱 종료 후에도 모니터링 지속
- ✅ WorkManager 정상 동작
- ✅ 백그라운드 제한 회피

### 🧪 Scenario 5: Quick Settings 통합 테스트

#### Test Case 5.1: Quick Settings Tile 기능
- **목적**: 빠른 설정에서 PTT 제어 확인
- **절차**:
  1. Quick Settings 패널 열기
  2. PTT 무전 타일 확인
  3. 타일 클릭으로 PTT 토글
  4. 상태 표시 정확성 확인

**예상 결과**:
- ✅ 타일 정상 표시
- ✅ 토글 동작 정상
- ✅ 상태 실시간 반영

### 🧪 Scenario 6: Android 버전 호환성 테스트

#### Test Case 6.1: Android 15 호환성
- **목적**: Android 15에서 접근성 서비스 자동 비활성화 대응 확인
- **검증 항목**:
  - 서비스 자동 비활성화 감지
  - 재활성화 가이드 제공
  - 백그라운드 제한 회피

#### Test Case 6.2: 이전 버전 호환성
- **목적**: Android 7.0+ 전체 버전 호환성 확인
- **검증 항목**:
  - API 레벨별 기능 분기 처리
  - 권한 요청 방식 차이 대응
  - UI 컴포넌트 호환성

---

## 📊 성공 지표

### 🎯 기능적 지표
- [ ] 볼륨키 이벤트 캡처율: **100%**
- [ ] PTT 시작 지연시간: **< 200ms**
- [ ] 백그라운드 동작 성공률: **≥ 95%**
- [ ] 서비스 자동 복구 시간: **< 30초**

### 🎯 안정성 지표
- [ ] 24시간 연속 동작 안정성
- [ ] 메모리 누수 없음
- [ ] 배터리 사용량 최적화
- [ ] 시스템 충돌 없음

### 🎯 사용성 지표
- [ ] 설정 완료율: **> 90%**
- [ ] 사용자 오류 발생률: **< 5%**
- [ ] 설정 소요 시간: **< 2분**

---

## 🔧 테스트 환경

### 필수 테스트 환경
1. **Android 15**: 최신 버전 호환성
2. **Android 11**: WorkManager 동작 확인
3. **Android 8.0**: 최소 지원 버전
4. **실제 기기**: 에뮬레이터로 불가능한 접근성 서비스 테스트

### 권장 테스트 시나리오
- **Samsung Galaxy**: 삼성 접근성 정책 확인
- **Google Pixel**: 순정 Android 동작 확인
- **기타 제조사**: OEM 커스터마이징 영향 확인

---

## ⚠️ 알려진 제한사항

### Android 15 관련
- 접근성 서비스 자동 비활성화 (대응책: 모니터링 시스템)
- 백그라운드 제한 강화 (대응책: WorkManager)

### 일반 제한사항
- 볼륨키 하드웨어 차이
- 제조사별 접근성 정책 차이
- 배터리 최적화 정책 차이

---

## 📝 테스트 체크리스트

### 설정 단계
- [ ] 접근성 서비스 활성화
- [ ] PTT 기능 활성화  
- [ ] Quick Settings 타일 추가
- [ ] 알림 권한 허용

### 기능 테스트
- [ ] 볼륨키 이벤트 캡처
- [ ] PTT 송신 시작/중지
- [ ] 백그라운드 동작
- [ ] 앱 전환 중 동작

### 모니터링 테스트  
- [ ] 서비스 비활성화 감지
- [ ] 재활성화 알림
- [ ] WorkManager 백그라운드 동작
- [ ] Quick Settings 상태 동기화

### 안정성 테스트
- [ ] 24시간 연속 동작
- [ ] 메모리 누수 체크
- [ ] 배터리 사용량 모니터링
- [ ] 시스템 안정성 확인